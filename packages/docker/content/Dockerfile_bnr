
# --- Building

FROM node:16-alpine AS build

WORKDIR /work

COPY . /work

RUN set -eux; \
    npm install; \
    npm run build


# --- Runtime

FROM node:16-alpine

WORKDIR /app

# Copy files from building container
COPY --from=build /dist /app/dist
COPY --from=build /package.json /app/

# Install production deps
RUN npm install --omit=dev; \
    npm install pm2 -g

ENTRYPOINT [ "/entrypoint.sh" ]
